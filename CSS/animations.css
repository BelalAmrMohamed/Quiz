/* ============================================================================
THEME INTEGRATION & VARIABLES
Leverage variables from themes.css for consistency across themes
============================================================================ */
:root,
[data-theme="light"],
[data-theme="dark-slate"],
[data-theme="dark"] {
  /* Animation Timings - Adjusted for more dynamic feel */
  --anim-duration-fast: 0.15s;
  --anim-duration-base: 0.3s;
  --anim-duration-slow: 0.5s;
  --anim-duration-slower: 0.7s;

  /* Easing Functions - More bouncy for gamification fun */
  --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
  --ease-out-back: cubic-bezier(0.175, 0.885, 0.32, 1.275);
  --ease-in-out-circ: cubic-bezier(0.785, 0.135, 0.15, 0.86);
  --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);

  /* Use theme-defined animation colors */
  --particle-primary: var(--anim-particle-1);
  --particle-secondary: var(--anim-particle-2);
  --particle-accent: var(--anim-particle-3);
  --orb-glow: var(--anim-orb);

  /* Shimmer Effect - For highlights and rewards */
  --shimmer-gradient: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.3) 50%,
    transparent 100%
  );

  /* Glass Morphism - For modal rewards and badges */
  --glass-bg: rgba(255, 255, 255, 0.8);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-blur: 15px;
}

/* Dark Theme Adjustments - Higher opacity for visibility */
[data-theme="dark-slate"],
[data-theme="dark"] {
  --particle-primary: var(--anim-particle-1);
  --particle-secondary: var(--anim-particle-2);
  --particle-accent: var(--anim-particle-3);
  --orb-glow: var(--anim-orb);

  --shimmer-gradient: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.2) 50%,
    transparent 100%
  );

  --glass-bg: rgba(30, 41, 59, 0.85);
  --glass-border: rgba(255, 255, 255, 0.1);
}

/* ============================================================================
CANVAS BACKGROUND INTEGRATION
Canvas animations are now handled by canvas-animation.js module
Body background will be controlled by canvas or fallback to theme color
============================================================================ */

/* FIXED: Ensure body background is visible when animations are enabled */
body {
  /* Fallback background when canvas is disabled or loading */
  background-color: var(--color-background);
  transition: background-color 0.3s ease;
}

/* FIXED: Properly hide canvas when animations are disabled */
[data-animations="disabled"] #canvas-bg {
  display: none !important;
}

/* FIXED: Ensure canvas is visible when animations are enabled */
[data-animations="enabled"] #canvas-bg {
  display: block !important;
}

/* ============================================================================
GAMIFICATION ENTRANCE ANIMATIONS
Fun pops and bounces for quiz elements
============================================================================ */
.pop-in {
  animation: popIn var(--anim-duration-base) var(--ease-out-back) forwards;
}

.bounce-in {
  animation: bounceIn var(--anim-duration-slow) var(--ease-spring) forwards;
}

.slide-up-reveal {
  animation: slideUpReveal var(--anim-duration-slow) var(--ease-out-expo)
    forwards;
}

.scale-pop {
  animation: scalePop var(--anim-duration-base) var(--ease-out-back) forwards;
}

@keyframes popIn {
  from {
    opacity: 0;
    transform: scale(0.5);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: translateY(-50px) scale(0.9);
  }
  60% {
    opacity: 1;
    transform: translateY(10px) scale(1.05);
  }
  100% {
    transform: translateY(0) scale(1);
  }
}

@keyframes slideUpReveal {
  from {
    opacity: 0;
    transform: translateY(30px);
    clip-path: inset(100% 0 0 0);
  }
  to {
    opacity: 1;
    transform: translateY(0);
    clip-path: inset(0 0 0 0);
  }
}

@keyframes scalePop {
  0% {
    opacity: 0;
    transform: scale(0);
  }
  70% {
    transform: scale(1.1);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* Staggered for quiz options or badges */
.stagger-gamify > * {
  opacity: 0;
  animation: bounceIn var(--anim-duration-slow) var(--ease-spring) forwards;
}

.stagger-gamify > *:nth-child(1) {
  animation-delay: 0.1s;
}
.stagger-gamify > *:nth-child(2) {
  animation-delay: 0.2s;
}
.stagger-gamify > *:nth-child(3) {
  animation-delay: 0.3s;
}
.stagger-gamify > *:nth-child(4) {
  animation-delay: 0.4s;
}
.stagger-gamify > *:nth-child(5) {
  animation-delay: 0.5s;
}

/* ============================================================================
INTERACTIVE GAMIFICATION EFFECTS
Hover bounces, selection pulses for quiz options
============================================================================ */
.hover-bounce {
  transition: transform var(--anim-duration-fast) var(--ease-spring);
}

.hover-bounce:hover {
  transform: translateY(-6px) scale(1.03);
}

.selection-pulse {
  position: relative;
  transition: all var(--anim-duration-fast) var(--ease-smooth);
}

.selection-pulse:active {
  transform: scale(0.97);
}

.selection-pulse::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: 0 0 0 0 var(--particle-primary);
  opacity: 0;
  transition: all var(--anim-duration-base) var(--ease-out-expo);
}

.selection-pulse.selected::after {
  box-shadow: 0 0 0 10px transparent;
  opacity: 1;
  animation: pulseRing 0.6s var(--ease-out-expo);
}

@keyframes pulseRing {
  0% {
    box-shadow: 0 0 0 0 var(--particle-primary);
  }
  100% {
    box-shadow: 0 0 0 20px transparent;
  }
}

.hover-sparkle {
  position: relative;
  overflow: hidden;
}

.hover-sparkle::before {
  content: "";
  position: absolute;
  inset: 0;
  background: var(--shimmer-gradient);
  transform: translateX(-100%);
  transition: transform 0.5s var(--ease-smooth);
}

.hover-sparkle:hover::before {
  transform: translateX(100%);
}

/* Quiz Button Enhancements */
.quiz-btn {
  position: relative;
  overflow: hidden;
  transition: all var(--anim-duration-base) var(--ease-out-back);
}

.quiz-btn::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.15);
  transform: scaleX(0);
  transform-origin: center;
  transition: transform var(--anim-duration-fast) var(--ease-out-expo);
}

.quiz-btn:hover::before {
  transform: scaleX(1);
}

.quiz-btn:active {
  transform: scale(0.95);
}

/* ============================================================================
QUIZ FEEDBACK ANIMATIONS
Correct/Incorrect with fun effects
============================================================================ */
.correct-feedback {
  animation: correctBounce var(--anim-duration-slow) var(--ease-spring) forwards;
}

.wrong-feedback {
  animation: wrongShake var(--anim-duration-base) var(--ease-smooth) 0s 2;
}

@keyframes correctBounce {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes wrongShake {
  0%,
  100% {
    transform: translateX(0);
  }
  20%,
  60% {
    transform: translateX(-5px);
  }
  40%,
  80% {
    transform: translateX(5px);
  }
}

/* Confetti for correct answers - More particles for fun */
.confetti-container {
  position: fixed;
  pointer-events: none;
  z-index: 9999;
  overflow: hidden;
}

.confetti-piece {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--particle-primary);
  animation: confettiExplode 2.5s var(--ease-out-expo) forwards;
  opacity: 0.9;
}

.confetti-piece:nth-child(odd) {
  background: var(--particle-secondary);
}

.confetti-piece:nth-child(even) {
  background: var(--particle-accent);
}

@keyframes confettiExplode {
  0% {
    transform: translate(0, 0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translate(var(--x), var(--y)) rotate(var(--rot));
    opacity: 0;
  }
}

/* ============================================================================
PROGRESS & LEVEL UP ANIMATIONS
Gamified bars and level pops
============================================================================ */
.progress-bar-fill {
  transition: width var(--anim-duration-slower) var(--ease-out-back);
  position: relative;
  overflow: hidden;
}

.progress-bar-fill::after {
  content: "";
  position: absolute;
  inset: 0;
  background: var(--shimmer-gradient);
  animation: progressSparkle 1.5s linear infinite;
}

@keyframes progressSparkle {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.level-up {
  animation: levelPop var(--anim-duration-slower) var(--ease-out-back) forwards;
}

@keyframes levelPop {
  0% {
    opacity: 0;
    transform: scale(0.5) translateY(50px);
  }
  60% {
    opacity: 1;
    transform: scale(1.2) translateY(-10px);
  }
  100% {
    transform: scale(1) translateY(0);
  }
}

/* Badge Unlock Animation */
.badge-unlock {
  animation: badgeSpin var(--anim-duration-slow) var(--ease-out-expo) forwards;
}

@keyframes badgeSpin {
  0% {
    opacity: 0;
    transform: rotate(-180deg) scale(0.8);
  }
  100% {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }
}

/* ============================================================================
MODAL & REWARD OVERLAYS
Glassy, fun modals for scores and badges
============================================================================ */
.reward-modal {
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur));
  border: 1px solid var(--glass-border);
  animation: modalPopIn var(--anim-duration-slow) var(--ease-out-back) forwards;
}

@keyframes modalPopIn {
  from {
    opacity: 0;
    transform: scale(0.8) translateY(50px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.reward-overlay {
  animation: overlayFade var(--anim-duration-base) var(--ease-smooth) forwards;
  backdrop-filter: blur(6px);
}

@keyframes overlayFade {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* ============================================================================
LOADING & TIMER ANIMATIONS
Engaging spinners and countdowns
============================================================================ */
.quiz-loader {
  width: 50px;
  height: 50px;
  border: 4px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: loaderSpin 1s linear infinite;
}

@keyframes loaderSpin {
  to {
    transform: rotate(360deg);
  }
}

.timer-tick {
  animation: timerPulse var(--anim-duration-fast) var(--ease-in-out-circ)
    infinite;
}

@keyframes timerPulse {
  0%,
  100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.8;
  }
}

/* ============================================================================
ACCESSIBILITY & PERFORMANCE
============================================================================ */
/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  #canvas-bg {
    display: none !important;
  }
}

/* Disable animations toggle */
[data-animations="disabled"] * {
  animation: none !important;
  transition-duration: 0.1s !important;
}

/* Utility Classes */
.delay-100 {
  animation-delay: 0.1s;
}
.delay-200 {
  animation-delay: 0.2s;
}
.delay-300 {
  animation-delay: 0.3s;
}

.will-animate {
  will-change: transform, opacity;
}

.gpu-accelerate {
  transform: translateZ(0);
  backface-visibility: hidden;
}
